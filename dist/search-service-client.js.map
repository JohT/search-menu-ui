{"mappings":"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","sources":["src/js/ponyfills/xmlHttpRequestPonyfill.js","src/js/search-service-client.js"],"sourcesContent":["\"use strict\";\n\nvar module = module || {}; // Fallback for vanilla js without modules\n/**\n * @namespace xmlHttpRequest\n */\nvar xmlHttpRequest = module.exports={}; // Fallback for vanilla js without modules\n\n/**\n * Provide the XMLHttpRequest constructor for Internet Explorer 5.x-6.x:\n * Other browsers (including Internet Explorer 7.x-9.x) do not redefine\n * XMLHttpRequest if it already exists.\n *\n * This example is based on findings at:\n * http://blogs.msdn.com/xmlteam/archive/2006/10/23/using-the-right-version-of-msxml-in-internet-explorer.aspx\n * @returns {XMLHttpRequest}\n * @memberof xmlHttpRequest\n */\n xmlHttpRequest.getXMLHttpRequest = function () {\n  if (typeof XMLHttpRequest !== \"undefined\") {\n    try {\n      var request = new XMLHttpRequest();\n      request.status; //try, if status is accessible. Fails in IE5.\n      return request;\n    } catch (e) {\n      console.log(\"XMLHttpRequest not available: \" + e);\n    }\n  }\n  try {\n    return new ActiveXObject(\"Msxml2.XMLHTTP.6.0\");\n  } catch (e) {\n    console.log(\"XMLHttpRequest Msxml2.XMLHTTP.6.0 not available: \" + e);\n  }\n  try {\n    return new ActiveXObject(\"Msxml2.XMLHTTP.3.0\");\n  } catch (e) {\n    console.log(\"XMLHttpRequest Msxml2.XMLHTTP.3.0 not available: \" + e);\n  }\n  try {\n    return new ActiveXObject(\"Microsoft.XMLHTTP\");\n  } catch (e) {\n    console.log(\"XMLHttpRequest Microsoft.XMLHTTP not available: \" + e);\n  }\n  // Microsoft.XMLHTTP points to Msxml2.XMLHTTP and is redundant\n  throw new Error(\"This browser does not support XMLHttpRequest.\");\n};\n","/**\n * @file Provides the (http) client/connection to the search backend service.\n * @version {@link https://github.com/JohT/search-menu-ui/releases/latest latest version}\n * @author JohT\n * @version ${project.version}\n */\n\n\"use strict\";\n\nvar module = datarestructorInternalCreateIfNotExists(module); // Fallback for vanilla js without modules\n\nfunction datarestructorInternalCreateIfNotExists(objectToCheck) {\n  return objectToCheck || {};\n}\n\n/**\n * Search-Menu Service-Client.\n * It provides the (http) client/connection to the search backend service.\n * @module searchMenuServiceClient\n */\nvar searchMenuServiceClient = (module.exports = {}); // Export module for npm...\nsearchMenuServiceClient.internalCreateIfNotExists = datarestructorInternalCreateIfNotExists;\n\nvar xmlHttpRequest = xmlHttpRequest || require(\"../../src/js/ponyfills/xmlHttpRequestPonyfill\"); // supports vanilla js & npm\n\n searchMenuServiceClient.HttpSearchConfig = (function () {\n  /**\n   * Configures and builds the {@link module:searchMenuServiceClient.HttpClient}.\n   * DescribedDataField is the main element of the restructured data and therefore considered \"public\".\n   * @constructs HttpSearchConfig\n   * @alias module:searchMenuServiceClient.HttpSearchConfig\n   */\n  function HttpSearchConfig() {\n    /**\n     * HTTP Search Configuration.\n     * @property {string} searchUrlTemplate URL that is called for every search request. It may include variables in double curly brackets like `{{searchtext}}`.\n     * @property {string} [searchMethod=\"POST\"] HTTP Method, that is used for every search request.\n     * @property {string} [searchContentType=\"application/json\"] HTTP MIME-Type of the body, that is used for every search request.\n     * @property {string} searchBodyTemplate HTTP body template, that is used for every search request. It may include variables in double curly brackets like `{{jsonSearchParameters}}`.\n     * @property {XMLHttpRequest} [httpRequest=new XMLHttpRequest()] Contains the XMLHttpRequest that is used to handle HTTP requests and responses. Defaults to XMLHttpRequest.\n     * @property {boolean} [debugMode=false] Adds detailed logging for development and debugging.\n     */\n    this.config = {\n      searchUrlTemplate: \"\",\n      searchMethod: \"POST\",\n      searchContentType: \"application/json\",\n      searchBodyTemplate: null,\n      /**\n       * Resolves variables in the search url template based on the given search parameters object.\n       * The variable {{jsonSearchParameters}} will be replaced by the JSON of all search parameters.\n       * @param {Object} searchParameters object properties will be used to replace the variables of the searchUrlTemplate\n       */\n      resolveSearchUrl: function (searchParameters) {\n        return resolveTemplate(this.searchUrlTemplate, searchParameters, this.debugMode);\n      },\n      /**\n       * Resolves variables in the search body template based on the given search parameters object.\n       * The variable {{jsonSearchParameters}} will be replaced by the JSON of all search parameters.\n       * @param {Object} searchParameters object properties will be used to replace the variables of the searchBodyTemplate\n       */\n      resolveSearchBody: function (searchParameters) {\n        return resolveTemplate(this.searchBodyTemplate, searchParameters, this.debugMode);\n      },\n      httpRequest: null,\n      debugMode: false\n    };\n    /**\n     * Sets the url for the HTTP request for the search.\n     * It may include variables in double curly brackets like {{searchtext}}.\n     * @param {String} value\n     * @return {module:searchMenuServiceClient.HttpSearchConfig}\n     */\n    this.searchUrlTemplate = function (value) {\n      this.config.searchUrlTemplate = value;\n      return this;\n    };\n    /**\n     * Sets the HTTP method for the search. Defaults to \"POST\".\n     * @param {String} value\n     * @return {module:searchMenuServiceClient.HttpSearchConfig}\n     */\n    this.searchMethod = function (value) {\n      this.config.searchMethod = value;\n      return this;\n    };\n    /**\n     * Sets the HTTP content type of the request body. Defaults to \"application/json\".\n     * @param {String} value\n     * @return {module:searchMenuServiceClient.HttpSearchConfig}\n     */\n    this.searchContentType = function (value) {\n      this.config.searchContentType = value;\n      return this;\n    };\n    /**\n     * Sets the HTTP request body template that may contain variables (e.g. {{searchParameters}}) in double curly brackets, or null if there is none.\n     * @param {String} value\n     * @return {module:searchMenuServiceClient.HttpSearchConfig}\n     */\n    this.searchBodyTemplate = function (value) {\n      this.config.searchBodyTemplate = value;\n      return this;\n    };\n    /**\n     * Sets the HTTP-Request-Object. Defaults to XMLHttpRequest if not set.\n     * @param {String} value\n     * @return {module:searchMenuServiceClient.HttpSearchConfig}\n     */\n    this.httpRequest = function (value) {\n      this.config.httpRequest = value;\n      return this;\n    };\n    /**\n     * Sets the debug mode, that prints some more info to the console.\n     * @param {boolean} value\n     * @return {module:searchMenuServiceClient.HttpSearchConfig}\n     */\n    this.debugMode = function (value) {\n      this.config.debugMode = value === true;\n      return this;\n    };\n    /**\n     * Uses the configuration to build the http client that provides the function \"search\" (parameters: searchParameters, onSuccess callback).\n     * @returns {module:searchMenuServiceClient.HttpClient}\n     */\n    this.build = function () {\n      if (!this.config.httpRequest) {\n        this.config.httpRequest = xmlHttpRequest.getXMLHttpRequest();\n      }\n      return new searchMenuServiceClient.HttpClient(this.config);\n    };\n  }\n\n  /**\n   * Resolves variables in the template based on the given search parameters object.\n   * The variable {{jsonSearchParameters}} will be replaced by the JSON of all search parameters.\n   * @param {String} template contains variables in double curly brackets that should be replaced by the values of the parameterSourceObject.\n   * @param {Object} parameterSourceObject object properties will be used to replace the variables of the template\n   * @param {boolean} debugMode enables/disables extended logging for debugging\n   * @memberof module:searchMenuServiceClient.HttpSearchConfig\n   * @protected\n   */\n  function resolveTemplate(template, parameterSourceObject, debugMode) {\n    if (template == null) {\n      return null;\n    }\n    var jsonSearchParameters = JSON.stringify(parameterSourceObject);\n    var resolvedBody = template;\n    resolvedBody = resolveVariableInTemplate(resolvedBody, \"jsonSearchParameters\", jsonSearchParameters);\n    resolvedBody = resolveVariablesInTemplate(resolvedBody, parameterSourceObject);\n    if (debugMode) {\n      console.log(\"template=\" + template);\n      console.log(\"{{jsonSearchParameters}}=\" + jsonSearchParameters);\n      console.log(\"resolved template=\" + resolvedBody);\n    }\n    return resolvedBody;\n  }\n\n  function resolveVariablesInTemplate(templateString, sourceDataObject) {\n    var resolvedString = templateString;\n    forEachFieldsIn(sourceDataObject, function (fieldName, fieldValue) {\n      resolvedString = resolveVariableInTemplate(resolvedString, fieldName, fieldValue);\n    });\n    return resolvedString;\n  }\n\n  function resolveVariableInTemplate(templateString, fieldName, fieldValue) {\n    //TODO could there be a better compatible solution to replace ALL occurrences instead of creating regular expressions?\n    var variableReplaceRegExp = new RegExp(\"\\\\{\\\\{\" + escapeCharsForRegEx(fieldName) + \"\\\\}\\\\}\", \"gm\");\n    return templateString.replace(variableReplaceRegExp, fieldValue);\n  }\n\n  function escapeCharsForRegEx(characters) {\n    var nonWordCharactersRegEx = new RegExp(\"([^-\\\\w])\", \"gi\");\n    return characters.replace(nonWordCharactersRegEx, \"\\\\$1\");\n  }\n\n  function forEachFieldsIn(object, fieldNameAndValueConsumer) {\n    var fieldNames = Object.keys(object);\n    var index, fieldName, fieldValue;\n    for (index = 0; index < fieldNames.length; index += 1) {\n      fieldName = fieldNames[index];\n      fieldValue = object[fieldName];\n      fieldNameAndValueConsumer(fieldName, fieldValue);\n    }\n  }\n\n  return HttpSearchConfig;\n}());\n\n/**\n * This function will be called, when search results are available.\n * @callback module:searchMenuServiceClient.HttpClient.SearchServiceResultAvailable\n * @param {Object} searchResultData already parsed data object containing the result of the search\n */\n\nsearchMenuServiceClient.HttpClient = (function () {\n  /**\n   * HttpClient.\n   *\n   * Contains the \"backend-connection\" of the search bar. It submits the search query,\n   * parses the results and informs the callback as soon as these results are available.\n   * @example new searchMenuServiceClient.HttpSearchConfig()....build();\n   * @param {module:searchMenuServiceClient.HttpSearchConfig} config \n   * @constructs HttpClient\n   * @alias module:searchMenuServiceClient.HttpClient\n   */\n  var instance = function (config) {\n    /**\n     * Configuration for the search HTTP requests.\n     * @type {module:searchMenuServiceClient.HttpSearchConfig}\n     */\n    this.config = config;\n    /**\n     * This function will be called to trigger search (calling the search backend).\n     * @function\n     * @param {Object} searchParameters object that contains all parameters as properties. It will be converted to JSON.\n     * @param {module:searchMenuServiceClient.HttpClient.SearchServiceResultAvailable} onSearchResultsAvailable will be called when search results are available.\n     */\n    this.search = createSearchFunction(this.config, this.config.httpRequest);\n  };\n\n  /**\n   * Creates the search service function that can be bound to the search menu.\n   * @param {module:searchMenuServiceClient.HttpSearchConfig} config Configuration for the search HTTP requests.\n   * @param {XMLHttpRequest} httpRequest Takes the HTTP-Request-Object.\n   * @returns {module:searchMenuServiceClient.SearchService}\n   * @memberof module:searchMenuServiceClient.HttpClient\n   * @private\n   */\n  function createSearchFunction(config, httpRequest) {\n    return function (searchParameters, onJsonResultReceived) {\n      var onFailure = function (resultText, httpStatus) {\n        console.error(\"search failed with status code \" + httpStatus + \": \" + resultText);\n      };\n      var searchUrl = config.resolveSearchUrl(searchParameters);\n      var searchBody = config.resolveSearchBody(searchParameters);\n      var request = { url: searchUrl, method: config.searchMethod, contentType: config.searchContentType, body: searchBody };\n      if (config.debugMode) {\n        onJsonResultReceived = loggedSuccess(onJsonResultReceived);\n      }\n      httpRequestJson(request, httpRequest, onJsonResultReceived, onFailure);\n    };\n  }\n\n  function loggedSuccess(onSuccess) {\n    return function (jsonResult, status) {\n      console.log(\"successful search response with code \" + status + \": \" + JSON.stringify(jsonResult, null, 2));\n      onSuccess(jsonResult, status);\n    };\n  }\n\n  /**\n   * This function will be called when a already parsed response of the HTTP request is available.\n   * @callback module:searchMenuServiceClient.HttpClient.ParsedHttpResponseAvailable\n   * @param {Object} resultData already parsed data object containing the results of the HTTP request\n   * @param {number} httpStatus HTTP response status\n   */\n  /**\n   * This function will be called when a response of the HTTP request is available as text.\n   * @callback module:searchMenuServiceClient.HttpClient.TextHttpResponseAvailable\n   * @param {Object} resultText response body as text\n   * @param {number} httpStatus HTTP response status\n   */\n  /**\n   * Executes an HTTP \"AJAX\" request.\n   *\n   * @param {Object} request - flattened json from search query result\n   * @param {string} request.url - name of the property in hierarchical order separated by points\n   * @param {string} request.method - value of the property as string\n   * @param {string} request.contentType - value of the property as string\n   * @param {string} request.body - value of the property as string\n   * @param {Object} httpRequest - Browser provided object to use for the HTTP request.\n   * @param {module:searchMenuServiceClient.HttpClient.ParsedHttpResponseAvailable} onSuccess - will be called when the request was successful.\n   * @param {module:searchMenuServiceClient.HttpClient.TextHttpResponseAvailable} onFailure - will be called with the error message as text\n   * @memberof module:searchMenuServiceClient.HttpClient\n   * @private\n   */\n  function httpRequestJson(request, httpRequest, onSuccess, onFailure) {\n    httpRequest.onreadystatechange = function () {\n      if (httpRequest.readyState === 4) {\n        if (httpRequest.status >= 200 && httpRequest.status <= 299) {\n          var jsonResult = JSON.parse(httpRequest.responseText);\n          onSuccess(jsonResult, httpRequest.status);\n        } else {\n          onFailure(httpRequest.responseText, httpRequest.status);\n        }\n      }\n    };\n    httpRequest.open(request.method, request.url, true);\n    httpRequest.setRequestHeader(\"Content-Type\", request.contentType);\n    httpRequest.send(request.body);\n  }\n\n  return instance;\n}());\n"],"names":["$3ed30644184af354$var$module","exports","getXMLHttpRequest","XMLHttpRequest","request","status","e","console","log","ActiveXObject","e1","e2","e3","Error","$65473c0e10e214e8$var$module","$65473c0e10e214e8$var$datarestructorInternalCreateIfNotExists","objectToCheck","$65473c0e10e214e8$var$searchMenuServiceClient","internalCreateIfNotExists","$65473c0e10e214e8$var$xmlHttpRequest","parcelRequire","HttpSearchConfig","resolveTemplate","template","parameterSourceObject","debugMode","resolvedString","jsonSearchParameters","JSON","stringify","resolvedBody","resolveVariableInTemplate","object","fieldNameAndValueConsumer","index","fieldName","fieldNames","Object","keys","length","forEachFieldsIn","fieldValue","templateString","characters","nonWordCharactersRegEx","variableReplaceRegExp","RegExp","replace","this","config","searchUrlTemplate","searchMethod","searchContentType","searchBodyTemplate","resolveSearchUrl","searchParameters","resolveSearchBody","httpRequest","value","build","HttpClient","search","onJsonResultReceived","onSuccess","onFailure","resultText","httpStatus","error","searchUrl","searchBody","url","method","contentType","body","jsonResult","onreadystatechange","readyState","parse","responseText","open","setRequestHeader","send","httpRequestJson","createSearchFunction"],"version":3,"file":"search-service-client.js.map","sourceRoot":"../"}
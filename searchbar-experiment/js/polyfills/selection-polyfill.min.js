// From https://github.com/luwes/selection-polyfill
!function(t,e){var n;if(!t.getSelection&&e.selection){n=null,t.getSelection=function(){return null!=n?n:n=new o},e.createRange=function(){return new Range},e.attachEvent("onkeydown",function(){return t.getSelection().setRangeAt(0,new Range(!0))}),e.attachEvent("onselectionchange",function(){var n,o;return t.getSelection().setRangeAt(0,new Range(!0)),n=e.selection.createRange().parentElement(),"INPUT"===n.tagName||"TEXTAREA"===n.tagName?(o=t.getSelection().getRangeAt(0),n.selectionStart=o.selectionStart,n.selectionEnd=o.selectionEnd):void 0}),t.Range=function(){function t(t){t?this.range=e.selection.createRange():(this.range=e.body.createTextRange(),this.collapse(!0)),this.init()}return t.END_TO_END="EndToEnd",t.END_TO_START="EndToStart",t.START_TO_END="StartToEnd",t.START_TO_START="StartToStart",t.prototype.init=function(){var t,e,n,o,i,a;return e=this.range.parentElement(),this.commonAncestorContainer=e,this.collapsed=0===this.compareBoundaryPoints("StartToEnd",this),a=this.range.duplicate(),a.moveToElementText(e),t=this.range.text.length>0?0:1,i=r.findLength("StartToStart",a,this.range),n=r.findNodeByPos(e,i,t),this.startContainer=n.el,this.startOffset=n.offset,o=r.findLength("StartToEnd",a,this.range),n=r.findNodeByPos(e,o,1),this.endContainer=n.el,this.endOffset=n.offset,this.selectionStart=r.findLength("StartToStart",a,this.range,!0),this.selectionEnd=r.findLength("StartToEnd",a,this.range,!0)},t.prototype.select=function(){return this.range.select()},t.prototype.setStart=function(t,e){var n,o;return r.getText(t).length>=e&&e>=0?(o=this.range.duplicate(),3===t.nodeType&&(n=r.findPosFromNode(t),o.moveToElementText(t.parentNode),o.moveStart("character",n+e)),-1===this.range.compareEndPoints("StartToEnd",o)&&this.range.setEndPoint("EndToStart",o),this.range.setEndPoint("StartToStart",o)):void 0},t.prototype.setEnd=function(t,e){var n,o;return r.getText(t).length>=e&&e>=0?(o=this.range.duplicate(),3===t.nodeType&&(n=r.findPosFromNode(t),o.moveToElementText(t.parentNode),o.moveStart("character",n+e)),this.range.setEndPoint("EndToStart",o)):void 0},t.prototype.selectNodeContents=function(t){return this.range.moveToElementText(t)},t.prototype.collapse=function(t){return t?this.range.setEndPoint("EndToStart",this.range):this.range.setEndPoint("StartToEnd",this.range)},t.prototype.compareBoundaryPoints=function(t,e){return this.range.compareEndPoints(t,e.range)},t.prototype.cloneRange=function(){var e;return e=new t,e.range=this.range.duplicate(),e.init(),e},t.prototype.detach=function(){return delete this.range},t.prototype.getBoundingClientRect=function(){var t,e;return e=this.range.getBoundingClientRect(),t={width:e.right-e.left,height:e.bottom-e.top,left:e.left,right:e.right,bottom:e.bottom,top:e.top}},t.prototype.toString=function(){return this.range.text||""},t}();var o;o=function(){function t(){this.selection=e.selection,this.ranges=[],this.init()}return t.prototype.init=function(){var t,e,n,o,r;return this.rangeCount=this.ranges.length,this.rangeCount?(e=this.ranges[0],null==this.prev&&(this.prev=e),0===e.compareBoundaryPoints(Range.END_TO_END,this.prev)?(o=["end","start"],t=o[0],n=o[1]):(r=["start","end"],t=r[0],n=r[1]),this.anchorNode=e[""+t+"Container"],this.anchorOffset=e[""+t+"Offset"],this.focusNode=e[""+n+"Container"],this.focusOffset=e[""+n+"Offset"],this.isCollapsed=this.anchorNode===this.focusNode):void 0},t.prototype.getRangeAt=function(t){return this.ranges[t]},t.prototype.setRangeAt=function(t,e){return this.prev=this.ranges[t],this.ranges[t]=e,this.init()},t.prototype.removeAllRanges=function(){return this.ranges=[],this.init()},t.prototype.addRange=function(t){var e,n,o,r,i;for(this.ranges.push(t),this.init(),r=this.ranges,i=[],n=0,o=r.length;o>n;n++)e=r[n],i.push(e.select());return i},t.prototype.deleteFromDocument=function(){return this.selection.clear()},t.prototype.toString=function(){return this.ranges[0].toString()},t}();var r;r={convertLineBreaks:function(t){return t.replace(/\r\n/g,"\n")},stripLineBreaks:function(t){return t.replace(/\r\n/g,"")},getText:function(t){return t.innerText||t.nodeValue},findLength:function(t,e,n,o){var i;switch(i=e.duplicate(),t){case"StartToStart":i.setEndPoint("EndToStart",n);break;case"StartToEnd":i.setEndPoint("EndToEnd",n)}return o?r.convertLineBreaks(i.text).length:r.stripLineBreaks(i.text).length},findNodeByPos:function(t,e,n){var o,r;return null==n&&(n=0),r={length:0,el:t,offset:0},(o=function(t,e,n,r){var i,a,s,h,c;for(h=t.childNodes,c=[],a=0,s=h.length;s>a;a++)if(i=h[a],!r.found)if(3===i.nodeType){if(r.length+i.length+n>e){r.found=!0,r.el=i,r.offset=e-r.length;break}c.push(r.length+=i.length)}else c.push(o(i,e,n,r));return c})(t,e,n,r),r},findPosFromNode:function(t){var e,n,o;return n={pos:0},o=t.parentNode,(e=function(t,n,o){var r,i,a,s,h;for(s=t.childNodes,h=[],i=0,a=s.length;a>i;i++)if(r=s[i],!o.found){if(r===n){o.found=!0;break}3===r.nodeType?h.push(o.pos+=r.length):r.hasChildNodes()?h.push(e(r,n,o)):h.push(void 0)}return h})(o,t,n),n.pos}}}}(window,document);